---
title: "TFM tasks"
author: "Fernando Lucas Ruiz (fernando.lucas@um.es)"
date: "`r Sys.Date()`"
output:
  html_document:
    df_print: paged
    highlight: kate
    number_sections: true
    theme: spacelab
    toc: true
    toc_float: true
    code_folding: "hide"
  pdf_document:
    toc: true
subtitle: Master en Bioinformática, Universidad de Murcia
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = T, warning = F, message = F)
```

# Punto de partida

## Correo botia primera idea

We have a set of samples S with longitudinal omics, and we assume they are free of technical biases.

We want to find a representation of the samples that look for association between specific samples and pathways.

We find a gene clustering (of whatever organization of the genes into groups that is of interest, I don´t care, you tell me), such that for all genes in the gene pool G={g1, g2, .., gn}, we find a clustering C={c1, c2, …, cm} such that all genes in G belong to a c in C, and only one c. Let us suppose that a cluster c in C is of interest to as because it resembles a phenotype (e.g., it is enriched for neurodegeneration related terms) or its expression correlates with case/control status. Based on the genes in c, we find a latent space of samples S. Then we develop a way to find relevant groups of samples within the latent space (e.g., a clustering, an outlier detection algorithm, any other heuristics), such that {sg1, sg2, …, sgk} are sample groups of interest. For all covariates of interest at the clinical data, what we do is to test whether there are significant differences between the covariates of any of the sample groups, in comparison with the rest of samples which do not belong to the group. If we detect such differences, we can say these guys can be identified by the corresponding covariate at the clinical data. If this is it, critical points are

-   How to deal with distances between samples when they are longitudinal

-   How to create the latent space (can be a PCA, but we can use deep learning approaches to find more interesting representations)

-   How to identify the samples, but this is easy.

## Dataset inicial ROS MAP

The Religious Orders Study (ROS) is a longitudinal, epidemiologic clinical-pathological study of memory, motor, and functional problems in older Catholic nuns, priests, and brothers aged 65 years and older from across the United States. Participants without known dementia agree to medical and psychological evaluation each year and brain donation after death. Since 1994, approximately 1,200 older persons have been enrolled and 580 are currently alive. Participants also have yearly blood draws which result in the storage of serum, plasma and cells.

The Memory and Aging Project (MAP) is a longitudinal, epidemiologic clinical-pathologic study of dementia and other chronic diseases of aging. Older persons are recruited from about 40 continuous care retirement communities and senior subsidized housing facilities around the Chicago metropolitan area. Participants without known dementia agree to annual detailed clinical evaluation and donation of brain, spinal cord and muscle after death. MAP began in 1997 and over 1,600 older adults have enrolled. Approximately 1,000 participants are currently alive. Participants also have yearly blood draws which result in the storage of serum, plasma and cells.

-   cogdx = final consensus cognitive diagnosis;

-   age_death = age at death;

-   msex = sex;

-   apoe4 = apoe4 allele count;

-   PMI = post-mortem interval;

-   braaksc = Braak stage;

-   ceradsc = Consortium to Establish a Registry for Alzheimer’s Disease (CERAD) score;

------------------------------------------------------------------------

# TO DO

-   [x] clustering con KEGG genes

-   [x] clustering con WGCNA genomewide

    -   [x] Me lo tiene que pasar Alicia

-   [x] Quitar todas las gráficas que sean de batch, RIN, PMI, edad y sexo

    -   [x] Dejar solo las que son braaksc, ceradsc, cogdx, apoe genotype y neuroStatus y study

-   [x] No utilizar test estadísticos porque las dimensiones de los no outliers impide la significancia estadística

-   [x] Ordenar por mecanismos según correo Botía.

    -   [x] Mecanismo de filtrado

        -   [x] KEGG

        -   [x] Andrews

    -   [x] Mecanismo de detección de outliers

        -   [x] KEGG

        -   [x] Andrews

    -   [x] Mecanismo de anotación basado en diferencias

        -   [x] KEGG

        -   [x] Andrews

    -   [x] Mecanismo de anotación dependiente del mecanismo de detección

        -   [x] KEGG

        -   [x] Andrews

-   [x] Hacer one-hot encoding de las variables categóricas de las covariables

-   [x] Diferenciar entre mPC1pos y mPC1neg.

    -   [x] KEGG

    -   [x] Andrews

-   [x] Calcular ratio de las covariables.

-   [x] Disminuir filtro a 1.5 SD

-   [x] Hacer test estadisticos a los ratios

    -   [x] fisher test

    -   [x] chi cuadrado

    -   [ ] buscar más tipos de test estadisticos

-   [x] Visualizar los ratios positivos y \>0 y significativos

    -   [x] Grafico de barras

    -   [x] Grafico ggnarstats

-   [x] De los genes con más loadings en cada caso ver si existe la posibilidad de ver enriquecimiento diferencial

    -   [x] Ver gprofiler

-   [x] Ver overlap entre muestras outliers de PCA y otros métodos

-   [x] Hacer upset plot

    -   [x] Con todas las muestras

    -   [x] Solamente con enfermos

-   [x] Realizar análisis estadístico también con casos y sanos.

-   [x] Pipeline caret de ranger para UMAP mUMAP1+ para sacar el varIMP

------------------------------------------------------------------------

# Preguntas

-   [x] Cuando hago el análisis estadístico es mejor hacerlo un grupo con el resto o un grupo con los "not in both". Por ejemplo mPC1 negative con mPC1 positivo + mPC2 positivo+mPC2 negativo+not in both, o mPC1 negative con solamente Not in both
-   [ ] Cuando hago el train del modelo de RF lo utilizo importance = "permutation" pero hay otra . Cual es mejor?

------------------------------------------------------------------------

# To read

------------------------------------------------------------------------

# Correos y reuniones

## **Reunión 2024-01-30**

Empezaremos con datos de Alzheimer

Clasificadores entre casos y controles no porque sea importante el clasificador sino para enfocarnos en los genes

Para determinados grupos de personas, determinar mecanismos concretos en los que para esas personas están enriquecidos

Para un determinado grupo de genes, cuáles son aquellas muestras concretas que están enriquecidas por placas neuríticas en base a esos genes? Encontraríamos un espacio latente de muestras. En base a ese grupo de genes, vamos a representar con UMAP o PCA cuáles son las muestras más extremas, esas son las enriquecidas o empobrecidas en esos genes. No buscamos expresión diferencial. Estamos interesados en detectar muestras, no genes. Buscamos identificar un sujeto que va a sufrir un determinado problema. 

Una estrategia para buscar un espacio latente (buscar estrategia no lineal, PCA o redes neuronales) de modo que maximizamos la oportunidad de encontrar muestras representativas que nos digan algo.

Cogemos los genes, los transformamos y los llevamos a un espacio latente. Cuáles son las muestras más extremas y buscar cuáles de ellas muestran alguna diferencia significativa en alguna covariable de los datos clínicos.

Cómo manejar distancias entre muestras.

Cómo crear el espacio latente.

Cómo identificar las muestras extremas. 

Una vez la pipeline automatizada se puede aplicar a este dataset o a cualquier otro. La idea es crear una herramienta, un paquete de R. 

Para identificar los grupos de genes nos fijamos en términos concretos que sabemos que están presentes en ese dataset. 

Te ayuda a identificar muestras concretas de pacientes concretos para aplicarle un determinado tratamiento.

## **Botia 2024-01-31**

Hola.

Fernando, como primer análisis propongo, en base a las muestras de ROSMAP que puedes encontrar aquí

Por un lado están los datos de expresión, aquí

​rds icon ROSMAP_RINPMIAGESEX_resids.rds

Y por el otro, los metadatos aquí.

​rds icon ROSMAP_RINPMIAGESEX_covs.rds

utilizar un clustering WGCNA genomewide que te va a parar Alicia también pues ya lo tenemos hecho. ¿O se te ocurre otro conjunto de genesets mejor Alicia?

Con ese clustering, lo que tienes es el C={c1, c2, …, cm} de abajo.

Así, un ci de C, con 1 \<= i \<= n, está formado por un número de genes concreto.

Ahora, entonces para cada ci en C, hacemos: paso 1. Nos quedamos solo con la expresión de los genes de ci. Hacemos un PCA de las muestras en base a los genes de ci. Seleccionamos aquellas muestras del PCA tales que el valor del PC1 para la muestra está fuera de 2 veces la desviación típica de los valores de PC1. Es decir, si d es la desviación típica de los valores de PC1, entonces una muestra se selecciona si su PC1 para esa muestra es \> que 2\*d o menor que -2 \* d.

Además, si d2 es la desviación típica de los valores de PC2, entonces una muestra se selecciona si su PC2 para esa muestra es \> que 2\*d2 o menor que -2 \* d2.

Una vez hecho esto, tendremos así tres grupos de muestras, que pueden solaparse. Unas muestras se habrán seleccionado solo por PC1 (lo llamamos mPC1, otras solo por PC2, mPC2, y otras por ambos, mPC12. El resto de muestras que no están en ninguno de esos tres los llamamos M’, siendo M el conjunto total de muestras.

Ahora, lo que tenemos que comprobar es si alguno de los tres grupos de muestras está enriquecido por algún fenotipo interesante, al compararlo con el resto de muestras del PCA dentro de los límites de 2d y 2d2. Es decir, el resto de muestras que no se han seleccionado en NINGUNO de los tres grupos.

¿Cómo hacemos eso?

Nos vamos al fichero de metadatos y buscamos covariables de interés.

Por ejemplo. Supongamos que las muestras que son extremas según PC1 queremos saber si los donantes son más viejos de lo normal. Nos quedamos con la covariable de la edad para todas las muestras.

Seleccionamos en m las muestras extremas según PC1. En m’ las muestras no extremas.

¿Cuál es el fold de la mediana de edad en m con respecto a la mediana de edad en m’?

¿Cuál es el p-valor de un Wilcoxon singned rank sum test? Si es significativo, tenemos una señal.

Y esto lo hacemos para mPC1, mPC2 y mPC3 y toda las covariables que tengamos.

Si la covariable no es numérica, sino que es categórica binaria (e.g., sexo) podemos hacer un Chi cuadrado comparando cómo se distribuye el sexo en el conjunto mPC correspondiente y en M’ y preguntar por el p-valor del test correspondiente.

¿OK?

Por supuesto, si hay alguna duda montamos un zoom rápido.

Ponedme en copia de los emails, porfa.

Salu2

## **Alicia 2024-01-31**

Hola,

Antes de nada, para que no haya dudas, recordar que estos datos ya están corregidos por variables técnicas (efecto batch, RIN, PMI...). Además, también están corregidos por edad y por sexo. Por lo tanto, no deberíamos detectar outliers por ninguna de estas variables (RIN, PMI, sexo o edad). En su lugar, tenemos que fijarnos en el resto de covariables de los donantes, siendo estas braaksc, ceradsc, cogdx e incluso apoe genotype. Todas estas covariables están incluidas en el fichero de metadatos. La columna neuroStatus nos indica si los donantes se clasificaron como controles (0) o como casos de AD (1). Cualquier duda sobre los datos me dices.

Para empezar el análisis, propongo usar un geneset relacionado con el Alzheimer lo más genérico posible para luego ir afinando cada vez más. En este caso, he buscado el termino "Alzheimer disease" en la base de datos KEGG y he extraído la lista de genes asociados con dicho término. Te adjunto el fichero con la lista de genes y copio también el código de R de cómo he obtenido los genes:

library(limma)\
library(AnnotationDbi)\
library(org.Hs.eg.db)\
tab \<- getGeneKEGGLinks(species="hsa")\
tab\$Symbol \<- mapIds(org.Hs.eg.db, tab\$GeneID,\
                       column="SYMBOL", keytype="ENTREZID")\
\
paths \<- getKEGGPathwayNames(species="hsa")\
paths[paths\$PathwayID=="hsa05010", ]\
genes \<- tab\$Symbol[tab\$PathwayID=="hsa05010"]\
write.table(genes, "C:/Users/alici/Downloads/KEGG_hsa05010_genes.txt", quote=FALSE, row.names = F)

Tendrías que coger la matriz de expresión de ROSMAP, quedarte solo con los genes de este geneset que te he pasado y con eso hacer un PCA. Luego, tendrías que extraer las coordenadas del PCA para saber dónde cae cada individuo (eso te lo devuelve la función) y ya determinar qué individuos son outliers y cuáles no con lo que te ha dicho Juan. Empezaría con este geneset a ver qué encontramos. Y luego ya podemos movernos a genesets de términos más concretos o genesets de WGCNA. 

Cualquier cosa nos dices.

## Alicia

Hola,

ya he podido acceder al html, está muy bien. Te recomiendo que incluyas un table of contents flotante o tabsheets para que sea más fácil ir de una sección a otra del report, ya que cada vez se hará más largo. Al final del report también estaría bien tener la tabla de covariables de los individuos seleccionados como outliers para buscar una posible explicación de porqué son outliers.

Ahora que ya tenemos un punto de partida, el siguiente paso sería probar otros métodos de reducción de la dimensionalidad. Dado que PCA es un método lineal, ahora tocaría probar un método no lineal como UMAP o tSNE. Además, también me gustaría que probáramos otros genesets de AD, esta vez más específicos. Para ello, te propongo usar los genes asociados con AD/demencia detectados con GWAS. En esta review puedes encontrar una tabla suplementaria con estos genes:

[https://www.thelancet.com/journals/ebiom/article/PIIS2352-3964(23)00076-2/fulltext](https://www.thelancet.com/journals/ebiom/article/PIIS2352-3964(23)00076-2/fulltext "https://www.thelancet.com/journals/ebiom/article/PIIS2352-3964(23)00076-2/fulltext")

Cualquier duda nos dices.

Saludos,

Alicia.

## **Alicia 2024-03-19**

Hola!

te paso algunos comentarios del análisis, de momento bastante generales.

\- Lo primero de todo, los datos estaban ya corregidos por batch, RIN, PMI, edad y sexo. Por lo tanto, todos los plots que muestren la distribución de estas covariables se pueden omitir. De esta forma, será más fácil centrarnos en las covariables que realmente nos interesan, siendo estas: braaksc, ceradsc, cogdx, apoe genotype y neuroStatus (study tampoco la descartaría, los outliers pueden venir del mismo estudio). 

\- El tema de si escalar o no los datos en el PCA, es preferible escalar los datos siempre. Los datos que estás usando no están escalados, lo he comprobado.

\- He visto que aplicas tests estadísticos para ver diferencias entre los no outliers y los outliers. No es correcto aplicar tests estadísticos aquí ya que tenemos muy pocos outliers y no tenemos suficiente poder estadístico como para encontrar alguna diferencia. También que los outliers pueden ser outliers por motivos diferentes cada uno, no tiene porqué haber un patrón. De momento, nos limitaremos a los plots y las tablas de covariables para caracterizar mejor a los outliers. Para ello, tenemos los PCA coloreados por covariable y veo que también has incluido barplots. Para que estos últimos sean más informativos, igual quitaría los no outliers de estos plots, ya que están muy representados, dejaría solo los tres tipos de outliers (PC1, PC2 y both) y usaría un geom_bar(stat="identity", position=position_dodge())

\- Por último, en este markdown hace falta un apartado donde se comparen las tres aproximaciones. Para ello, me gustaría ver en un mismo panel de figuras, el PCA, el UMAP y el tSNE obtenidos a partir del mismo conjunto de genes de AD, para ver si hay alguna técnica que separe mejor los individuos que otra. También me gustaría ver el overlap de outliers entre las tres aproximaciones si es posible. Luego, si probamos otros conjuntos de genes de AD como el de GWAS, me gustaría ver la comparativa entre aproximaciones y entre conjuntos de AD. 

Cuando tengas esto, podemos quedar para discutir cosas más concretas de los resultados, gracias!

Saludos,

Alicia.

## Reunión 2024-04-30

Tenemos que comparar los resultados de las covariables de los outliers con los no outliers de cada técnica. Para ello tenemos que calcular el ratio del ratio de cada covariable entre outliers y no outliers. Es decir, por ejemplo:

$log2((ROS/MAP)outliers/(ROS/MAP) no outliers)$

Si son vas clases pues todas contra la 1.

Por otro lado tenemos que diferenciar entre las muestras que son outliers de una componente entre positivos y negativos, ya que se separan por cosas distintas.

## Botia 2024-04-30

Por centrar un poco el TFM, debería haberlo escrito mucho antes pero no me da para más. Lo siento.

Título: Detección de covariables discriminantes en grupos de variables

Definición del problema

Tenemos una matriz de predictores biológicos, que es de alta dimensionalidad sobre individuos. Sea Mnxm dicha matriz, en donde n es el número de individuos y m es el número de predictores diferentes (pueden ser genes, sondas de metilación, proteínas, da igual). Tenemos también una matriz de datos clínicos sobre los n individuos, Cnxd en donde d es el número de dimensiones de esta matriz. En esta matriz, todas las d variables son numéricas. Además, tenemos una segunda matriz de datos clínicos C’nxd’ en donde cada una de las d’ columnas es de naturaleza binaria (e.g, sexo, caso/control). Nótese que si originalmente tuviéramos alguna columna categórica con más de 2 valores, la transformamos a una codificación one-hot generándose tantas variables en C’ como valores posibles puede tener la variable original. Entonces, C’nxd’ es tal que todas sus columnas son de naturaleza binaria porque han pasado por un proceso de conversión desde k-arias a binarias mediante one-hot. 

Por otro lado, tenemos un mecanismo de filtrado de la matriz Mnxm para convertirla en una matriz Mnxm’, con m’ \<\< n. Ese filtrado no transforma los datos, solo filtra predictores. El mecanismo de filtrado concreto dependerá del tipo de predictor que tengamos en M. Por ejemplo, si M es una matriz de genes, en lugar de usar toda una matriz de genes, podemos quedarnos con los genes asociados al Alzheimer según KEGG. A esto lo denominamos un geneset de M. Podemos tener tantos genesets como queramos. Cada geneset es interesante para aprender sobre los individuos de M desde ese fenómeno biológico específico. El ejemplo de KEGG me permite estudiar a los individuos desde el punto de vista de la influencia del Alzheimer en esos genes. Pero si en lugar de ese geneset hubiéramos escogido uno relacionado con marcadores de microglia, podríamos haber estudiado a los individuos en base la microglía. 

Nuestro problema es el siguiente: dado el geneset G, ¿tiene alguna utilidad como grupo de marcadores multivariable a la hora de organizar a los individuos de mi cohorte? ¿qué me dicen estos marcadores sobre los individuos extremos de esa cohorte?

La forma de resolverlo que proponemos aquí es la siguiente.

Dado dicho geneset G de M, queremos descubrir sujetos extremos en las filas de M, para ese geneset. Los sujetos extremos para ese geneset son aquellos que estarán más afectados según los predictores de M porque presentan más varianza. Dado el mecanismo para detectar esos sujetos extremos, posteriormente debemos explicar qué los hace extremos. Es decir, por un lado tenemos un mecanismo para detectar los sujetos más extremos. Llamémoslo mecanismo para detección de outliers multivariante (en donde cada una de las variables es un gen de nuestro geneset). Por otro lado tenemos, para dicho mecanimo de detección de outliers multivariante, una técnica para explicar por qué esos sujetos son extremos. Llamémoslo mecanismo de anotación de outliers. Uno de esos mecanismos, que es independiente de qué mecanismo de detección usamos y por tanto podemos usarlo siempre, es el basado en las diferencias entre outliers y no outliers. Lo llamaremos anotación de outliers basado en diferencias. Y es el que hemos hablado de los ratios. Analizamos los ratios para cada variable en C y C’. El otro mecanismo dependerá de si el mecanismo de detección nos da alguna forma de interpretar los outliers. Por ejemplo el PCA puede interpretar los outliers mirando a los vectores de carga (loadings) de los PCs. A este lo llamaremos mecanismo de anotación dependiente del mecanismo de detección.

Vamos a experimentar sobre diferentes combinaciones de los siguientes tres elementos.

Mecanismo de filtrado (cualquier geneset guiado por una hipótesis biológica, por ejemplo los genes de GWAS de AD, los de KEGG de AD o los de cualquier grupo de genes asociados de alguna forma a la neuro-degeneración.

Mecanismo de detección de outliers (PCA, UMAP, t-SNE, son todos basados en transformaciones de los datos originales en otra cosa)

Mecanismo de anotación basado en diferencias (aquí no hay posibilidades, solo está el mecanismo de los ratios)

Mecanismo de anotación dependiente del mecanismo de detección (PCA: mirar a los loadings y ver qué genes son relevantes en cada eje)

¿OK?

Esto lo he escrito para centrar el TFM.

Por un lado estamos combinando preguntas sobre el Alzheimer con preguntas sobre técnicas. Nuestra estrategia se basa en ver qué preguntas sobre el Alzheimer se contestan mejor según la técnica.

Salu2

## Alicia Whatsapp 2024-05-10

básicamente queremos comprobar la proporción que hay de hombres por ejemplo entre casos outliers de PC1 y casos no outliers.

Necesitaríamos saber si en alguna de las comparativas, hay un grupo con menos de 5 individuos

[https://medium.com/\@chirag1162/chi-square-test-yates-continuity-correction-in-r-5d598a543cf8](https://medium.com/@chirag1162/chi-square-test-yates-continuity-correction-in-r-5d598a543cf8){.uri}

<https://statsandr.com/blog/fisher-s-exact-test-in-r-independence-test-for-a-small-sample/>

O sea, como resultado necesitaríamos una tabla donde cada fila sea una covariable que has probado (o un valor de una covariable, e.g. braaksc=1), la primera columna sería la frecuencia mínima que se ha detectado en la tabla de contingencia para esa variable, y luego otras dos columnas para el p-valor que se ha obtenido con un chi-square y el p-valor que se ha obtenido del test de Fisher, según el que aplique

## Juan 2024-05-14

Hola de nuevo.

Solo estamos trabajando con los casos ¿verdad? Me refiero a que ya desde la selección de individuos mediante PCA solo se representan casos, ¿cierto?

Otra cosa, cuando comparas los outliers, los comparas contra el resto de la población, ¿no? No contra TODA la población, sino contra la población sin outliers (ni positivos ni negativos, los que caen en medio)

Los apartados 8.1 y 8.2 son muy interesantes, y muestran que de alguna forma cogemos muestras muy parecidas ¿no? Quedaría mejor un upset plot 

[https://github.com/hms-dbmi/UpSetR](https://urldefense.com/v3/__https://github.com/hms-dbmi/UpSetR__;!!D9dNQwwGXtA!SSvqPvlJ9ZCYUT_g0-Gp1Nc_4qrq5JlJUmg261wm5ehsI2NBljwwUL3G1grUNFrP3ZoYMHSQOmBzbWkiXCDOA16TT00$ "https://urldefense.com/v3/__https://github.com/hms-dbmi/UpSetR__;!!D9dNQwwGXtA!SSvqPvlJ9ZCYUT_g0-Gp1Nc_4qrq5JlJUmg261wm5ehsI2NBljwwUL3G1grUNFrP3ZoYMHSQOmBzbWkiXCDOA16TT00$")

para eso en lugar del plot de la 8.1. Yo añadiría también el conjunto de muestras completas, controles y casos también.

Está muy bien el ploteado de los tests nominalmente significativos, con cogdx.

Ten paciencia, vamos a darle una vuelta más

## Alicia 2024-05-15

Hola,

\- Respecto a los análisis estadísticos, normalmente usamos un umbral de significancia de 0.05. Además, en los únicos tests que parecen ser significativos (P\<0.05), la frecuencia mínima en esa comparativa es inferior a 1. Pongo aquí un ejemplo.

En estos casos donde una de las frecuencias mínima es tan pequeña, no tengo claro que el test sea lo suficientemente informativo.

\- Por otro lado, para hacer el enriquecimiento funcional, gprofiler2 es una de las herramientas más conocidas. Concretamente, con la función gost puedes obtener el enriquecimiento para diferentes conjuntos de genes:

<https://rdrr.io/cran/gprofiler2/man/gost.html>

Para ello, normalmente usamos como bases de datos GO, KEGG y REAC, aunque solo con GO sería suficiente en este caso (ver argumento sources). Además, si en la llamada a la función incluyes multi_query=T, te devuelve una comparativa del enriquecimiento entre los diferentes conjuntos de genes. Para representar el enriquecimiento te recomiendo un plot de este tipo. En nuestro caso, tendrías cuatro columnas (PC1+, PC1-, PC2+, PC2-). 

![gprofiler2 -- an R package for gene list functional enrichment analysis and namespace conversion toolset g:Profiler. - Abstract - Europe PMC](https://europepmc.org/articles/PMC7859841/bin/f1000research-9-29655-g0003.jpg)

La pregunta es ¿cuántos genes vas a coger de cada componente para hacer el enriquecimiento? Yo probaría diferentes tamaños, ya que si el conjunto de genes es muy pequeño puede ser que no haya enriquecimiento. Por ejemplo, cogería el top 10, 20, 30 de PC1+, PC1-, PC2+, PC2-.

\- Respecto a tu pregunta sobre cómo extraer los genes más importantes del UMAP, dijimos que UMAP solo se iba a utilizar para visualizar los resultados y comparar los outliers, pero no para extraer los genes más importantes. 

Saludos,

Alicia.

## Juan 2024-05-15

Fer, esto cada vez tiene mejor pinta.

Pero, y esto es una tontería, tienes que ser un poco más didáctico. Esto está creciendo mucho y no hay manera de navegar adecuadamente por el documento porque el índice no ayuda demasiado. ¿Cómo se puede saber por el índice flotante que estoy en la sección de SOLO CASOS o bien CASOS + CONTROLES?

Con respecto a la interpretación de UMAP o TSNE, simplemente no puedes directamente. Esos métodos no son interpretables per se.

De hecho, el mecanismo que estamos usando de detectar los outliers de UMAP cogiendo los valores más extremos a partir de cada eje no estoy seguro de que sea correcto, aunque funcione… De hecho, con UMAP lo que deberíamos es hacer un clustering y tratar cada grupo detectado por el clustering aunque esto es otra historia. Vamos a dejarlo así de momento. Si te fijas, la sección 7.3., el plot de UMAP está muy bien porque hay un cluster verde oliva uUMAP1 positive que es el que se lleva casi todas las señales (8 de 10). 

Ahora bien, ¿cómo podemos interpretar las señales de manera indirecta aun estando en un UMAP para saber qué genes están generando esas señales?

Fácil. Te quedas con los genes de Alzheimer que has obtenido en la sección 2. Y con todos los sujetos. Y con eso ya tienes la matriz de transcriptómica que necesitas (sujetos en las filas, genes en las columnas).

Luego transformas la matriz en un dataset de clasificación binaria, tal que los sujetos detectados por UMAP pc1 positive, los etiquetas como “Outlier” en una columna nueva de la matriz, que llamas “Class” y al resto de individuos de la cohorte los etiquetas como “Normal”. Y con eso haces un random forest para predecir “Class”, y con varIMP obtienes las variables más importantes y esos serán tus genes : - ) Lo que yo haría sería usar la típica parrilla de parámetros de ranger, con kernel polinomial, mtry con una lista de valores usando como valor central la raíz cuadrada del número de genes de la sección 2, y dos valores más a la izquierda y a la derecha y que use para decidir el mejor modelo el accuracy balanceado (es un problema desbalanceado). Así tendrás los genes relevantes.

¿Cómo lo ves?

Después de esto, usando todos los genes del Alzheimer, hacemos un GSEA utilizando como mecanismo de importancia de cada gen la importancia de varIMP y esto te dará los genes MAS asociados a la covariable a partir de la cual se ha generado la señal. Si tenemos suerte, a parte de Alzheimer como señal que esa es evidente que tiene que salir, según te salga el enriquecimiento, por ejemplo, suponte que te sale un pathway relacionado con oxidación de lípidos como muy significativo. Estaría superchulo hacer la misma operación COMPLETA para los genes de ese pathway. Y mediante el mismo mecanismo llegar a que obtenemos, al final un enriquecimiento de genes de Alzheimer.  Es decir, el método sería robusto si a partir del Alzheimer llegamos a la oxidación de lípidos y si a partir de la oxidación de lípidos llegamos al Alzheimer. ¿OK?

Pero básicamente, lo que haría ahora es (1) cerraría el markdown que estás trabajando añadiendo lo que te digo arriba de los títulos, y añadir en la sección 7.3 la pipeline caret de ranger, hasta llegar a varIMP. Y de ahí añadir en la sección 9, el análisis de enriquecimiento GSEA que haga uso de los valores de varIMP.

Y luego, repetir TODO el Markdown cambiando en la sección 2 los genes de Alzheimer por los del pathway que te salga en la sección 9 del Markdown cerrado.

¿Lo pillas?
